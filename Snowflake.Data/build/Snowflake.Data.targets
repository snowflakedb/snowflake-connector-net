<?xml version="1.0" encoding="utf-8"?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <!--
    Determine the target architecture.
    Prioritize explicit RuntimeIdentifier (RID) or PlatformTarget.
    Fallback to x64 if nothing is specified (standard for AnyCPU on Windows).
  -->
  <PropertyGroup>
    <SfMiniCoreArch Condition="'$(RuntimeIdentifier)' == 'win-x64' Or '$(PlatformTarget)' == 'x64'">x64</SfMiniCoreArch>
    <SfMiniCoreArch Condition="'$(RuntimeIdentifier)' == 'win-arm64' Or '$(PlatformTarget)' == 'ARM64'">arm64</SfMiniCoreArch>
    <!-- Default to x64 if architecture is not explicitly arm64 -->
    <SfMiniCoreArch Condition="'$(SfMiniCoreArch)' == ''">x64</SfMiniCoreArch>
  </PropertyGroup>

  <!-- Copy native library for ALL Windows targets -->
  <ItemGroup Condition="$([MSBuild]::IsOSPlatform('Windows'))">
    <NativeLibrary Include="$(MSBuildThisFileDirectory)..\runtimes\win-x64\native\sf_mini_core.dll" Condition="'$(SfMiniCoreArch)' == 'x64'" />
    <NativeLibrary Include="$(MSBuildThisFileDirectory)..\runtimes\win-arm64\native\sf_mini_core.dll" Condition="'$(SfMiniCoreArch)' == 'arm64'" />
  </ItemGroup>

  <Target Name="CopyMiniCoreNativeLibraries" AfterTargets="Build">
    <Copy SourceFiles="@(NativeLibrary)" DestinationFolder="$(OutputPath)" SkipUnchangedFiles="true" Condition="'@(NativeLibrary)' != ''" />
  </Target>
</Project>
